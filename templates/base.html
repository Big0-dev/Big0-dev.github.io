<!doctype html>
<html lang="en">
  <head>
    <meta charset="UTF-8" />
    <meta name="viewport" content="width=device-width, initial-scale=1.0" />
    <meta name="description" content="{% block meta_description %}{{ meta_des | safe }}{% endblock %}" />
    <meta name="google-site-verification" content="WnZ4Pn2o-OMiNi8NhWoBV8-_lPR0Fc2IwDPABZBq_uo" />
    {% if base_tag %} {{ base_tag | safe }} {% endif %} 
    <link rel="canonical" href="{{ domain }}{% block canonical_path %}/{% endblock %}">
    <title>{% block title %}Page{% endblock %} - Big0</title>
    
    {% block preload %}
    {% if preload %}
    <link
      rel="preload"
      as="image"
      href="{{ static }}/{{ preload }}-mini.avif"
      type="image/avif"
      media="(max-width: 767px)"
    />
    <link
      rel="preload"
      as="image"
      href="{{ static }}/{{ preload }}.avif"
      type="image/avif"
      media="(min-width: 768px)"
    />
    {% endif %}
    {% endblock %}

    <link
      rel="preload"
      href="{{ static }}/Exo2-Regular.woff2"
      as="font"
      type="font/woff2"
      crossorigin="anonymous"
    />

    <!-- Preconnect to external origins -->
    <link rel="preconnect" href="https://www.googletagmanager.com">
    <link rel="preconnect" href="https://www.clarity.ms">
    <link rel="preconnect" href="https://static.cloudflareinsights.com">
    
    <!-- Preload critical CSS -->
    <link rel="preload" href="{{ static }}/design-system.css" as="style">
    <link rel="preload" href="{{ static }}/base.css" as="style">
    
    <!-- Critical inline CSS for initial render -->
    <style>
      /* Minimal critical CSS */
      :root{--primary-color:#7f3e98;--bg-dark:#0a0a0d;--text-primary:#ffffff;--text-secondary:#e0e0e0;--text-tertiary:#a0a0a0;--container-max:1200px;--space-md:16px}
      *{margin:0;padding:0;box-sizing:border-box}
      body{font-family:'Exo 2',-apple-system,BlinkMacSystemFont,'Segoe UI',sans-serif;background:var(--bg-dark);color:var(--text-primary);line-height:1.6}
      .page-wrapper{min-height:100vh}
      .container{max-width:var(--container-max);margin:0 auto;padding:0 var(--space-md)}
    </style>
    
    <!-- Load CSS with media attribute for non-critical styles -->
    <link rel="stylesheet" href="{{ static }}/design-system.css" />
    <link rel="stylesheet" href="{{ static }}/base.css" />
    <link rel="stylesheet" href="{{ static }}/components.css" media="print" onload="this.media='all'">
    <noscript><link rel="stylesheet" href="{{ static }}/components.css"></noscript>

    {% block custom_css %}
    {% if custom_css %}
        <link rel="stylesheet" href="{{ static }}/{{ custom_css }}.css" media="print" onload="this.media='all'">
        <noscript><link rel="stylesheet" href="{{ static }}/{{ custom_css }}.css"></noscript>
    {% endif %}
    {% endblock %}

    <!-- Favicons -->
    <link rel="icon" type="image/png" href="{{ path_prefix }}favicon.png">
    <link rel="apple-touch-icon" href="{{ path_prefix }}favicon.png">
    
    <!-- RSS Feed -->
    <link rel="alternate" type="application/rss+xml" title="Big0 - News & Insights RSS Feed" href="{{ path_prefix }}rss.xml">
    <script src="{{ static }}/minisearch@7.1.2.min.js" defer></script>
    <script src="{{ static }}/search.js" defer></script>

    <script
      async
      src="https://www.googletagmanager.com/gtag/js?id=G-5BCYEF9S7N"
    ></script>
    <script>
      window.dataLayer = window.dataLayer || [];
      function gtag() {
        dataLayer.push(arguments);
      }
      gtag("js", new Date());
      gtag("config", "G-5BCYEF9S7N");
    </script>
    <script type="text/javascript">
    (function(c,l,a,r,i,t,y){
        c[a]=c[a]||function(){(c[a].q=c[a].q||[]).push(arguments)};
        t=l.createElement(r);t.async=1;t.src="https://www.clarity.ms/tag/"+i;
        y=l.getElementsByTagName(r)[0];y.parentNode.insertBefore(t,y);
    })(window, document, "clarity", "script", "sbshmbsh9d");
    </script>
  </head>

  <body>
    <div class="page-wrapper">
      <!-- Navigation -->
      <nav class="navbar" id="navbar">
        <div class="container nav-container">
          <a href="{{ home }}" class="nav-logo" aria-label="Home">
            <div class="nav-logo-wrapper">
              {{ inject_svg('big0_logo', False) | safe }}
            </div>
          </a>

          <!-- Mobile Menu Toggle -->
          <button
            class="hamburger-btn hide-desktop"
            popovertarget="sideMenuPopover"
            popovertargetaction="toggle"
            aria-label="Open menu"
          >
            <span class="hamburger-line"></span>
            <span class="hamburger-line"></span>
            <span class="hamburger-line"></span>
          </button>

          <!-- Mobile Menu Popover -->
          <div popover="manual" id="sideMenuPopover" class="side-menu-popover">
            <div class="side-menu-container">
              <div class="popover-header">
                <button
                  class="close-btn"
                  popovertarget="sideMenuPopover"
                  popovertargetaction="hide"
                  aria-label="Close menu"
                >
                  <span class="close-line"></span>
                  <span class="close-line"></span>
                </button>
              </div>

              <ul class="popover-menu">
                <li><a href="{{ about }}" aria-label="About Us">About Us</a></li>
                <li><a href="{{ services_page }}" aria-label="Services">Services</a></li>
                <li><a href="{{ blog }}" aria-label="Insights">Insights</a></li>
                <li><a href="{{ case_studies }}" aria-label="Case Studies">Case Studies</a></li>
                <li><a href="{{ careers }}" aria-label="Careers">Careers</a></li>
                <li>
                  <a href="{{ contact }}" aria-label="Contact">Contact</a>
                </li>
                <li>
                  <button class="search-button" popovertarget="search-modal">
                    {{ inject_svg('search_icon', True, 'search-icon') | safe }}
                  </button>
                </li>
              </ul>
            </div>
          </div>
          
          <!-- Desktop Menu -->
          <div class="nav-menu hide-mobile" id="nav-menu">
            <div class="nav-links">
              <a href="{{ about }}" class="nav-link" aria-label="About Us">About Us</a>
              <a href="{{ services_page }}" class="nav-link" aria-label="Services">Services</a>
              <a href="{{ blog }}" class="nav-link" aria-label="Insights">Insights</a>
              <a href="{{ case_studies }}" class="nav-link" aria-label="Case Studies">Case Studies</a>
              <a href="{{ careers }}" class="nav-link" aria-label="Careers">Careers</a>
              <a href="{{ contact }}" class="nav-link" aria-label="Contact">Contact</a>
            </div>
          </div>
          
          <!-- Desktop Actions -->
          <div class="nav-actions hide-mobile">
            <button
              aria-label="Search"
              class="btn btn-secondary btn-sm nav-search-btn"
              popovertarget="search-modal"
            >
              {{ inject_svg('search_icon', True, 'search-icon nav-search-icon') | safe }}
            </button>
          </div>
        </div>
      </nav>

      <!-- Search Modal Popover -->
      <div id="search-modal" popover class="search-popover">
        <div class="search-container">
          <div class="search-header">
            <h2 class="text-2xl font-bold mb-lg">Search</h2>
            <button
              class="close-btn"
              popovertarget="search-modal"
              aria-label="Close search"
            >
              <span class="close-line"></span>
              <span class="close-line"></span>
            </button>
          </div>
          <form id="search-form">
            <div class="search-input-container">
              <input
                type="text"
                id="search-input"
                name="q"
                placeholder="Search insights, services, resources..."
                aria-label="Search input"
                autocomplete="off"
                required
              />
              <button
                type="submit"
                class="search-submit"
                aria-label="Submit search"
              >
                {{ inject_svg('search_icon', True, 'search-submit-icon') | safe }}
              </button>
            </div>
          </form>

          <div id="search-results-container" class="search-results-container">
            <div id="search-results" class="search-results"></div>
          </div>
        </div>
      </div>

      <!-- Main Content -->
      <main class="main-content">
        {% block content %}
        {{ content | safe }}
        {% endblock %}
      </main>

      <!-- Footer -->
      <footer class="footer" role="contentinfo">
        <div class="container">
          <div class="footer-content">
            <!-- Footer Links -->
            <div class="footer-section">
              <h4>Company</h4>
              <div class="footer-links">
                <a href="{{ home }}" class="footer-link">Home</a>
                <a href="{{ about }}" class="footer-link">About Us</a>
                <a href="{{ careers }}" class="footer-link">Careers</a>
              </div>
            </div>

            <div class="footer-section">
              <h4>Services</h4>
              <div class="footer-links">
                <a href="{{ services_page }}" class="footer-link">Our Services</a>
                <a href="{{ industries }}" class="footer-link">Industries</a>
                <a href="{{ partners }}" class="footer-link">Partners</a>
              </div>
            </div>

            <div class="footer-section">
              <h4>Resources</h4>
              <div class="footer-links">
                <a href="{{ blog }}" class="footer-link">Insights</a>
                <a href="{{ case_studies }}" class="footer-link">Case Studies</a>
                <a href="{{ products }}" class="footer-link">Products</a>
              </div>
            </div>

            <div class="footer-section">
              <h4>Support</h4>
              <div class="footer-links">
                <a href="{{ contact }}" class="footer-link">Contact</a>
                <a href="{{ gallery }}" class="footer-link">Gallery</a>
                <a href="{{ news }}" class="footer-link">News</a>
              </div>
            </div>

            <div class="footer-section">
              <h4>Legal</h4>
              <div class="footer-links">
                <a href="{{ privacy }}" class="footer-link">Privacy Policy</a>
                <a href="{{ terms }}" class="footer-link">Terms of Service</a>
                <a href="{{ compliance }}" class="footer-link">Compliance</a>
              </div>
            </div>

            <div class="footer-section">
              <h4>Technical</h4>
              <div class="footer-links">
                <a href="{{ sitemap }}" class="footer-link">Sitemap</a>
                <a href="{{ image_sitemap }}" class="footer-link">Image Sitemap</a>
                <a href="{{ path_prefix }}rss.xml" class="footer-link">RSS Feed</a>
              </div>
            </div>
          </div>

          <!-- Footer Bottom -->
          <div class="footer-bottom">
            <p class="text-sm text-tertiary">
              © {{ copyright }} Big0 Dev Private Limited. All rights reserved.
            </p>
            <div class="footer-social">
              <a 
                href="https://linkedin.com/company/big0" 
                class="social-link"
                aria-label="Follow us on LinkedIn" 
                target="_blank"
                rel="noopener noreferrer"
              >
                {{ inject_svg('linkedin', True) | safe }}
              </a>
              <a 
                href="https://github.com/Big0-dev" 
                class="social-link"
                aria-label="Visit our GitHub" 
                target="_blank"
                rel="noopener noreferrer"
              >
                {{ inject_svg('github', True) | safe }}
              </a>
              <a 
                href="https://www.youtube.com/@big0_dev" 
                class="social-link"
                aria-label="Subscribe to our YouTube channel" 
                target="_blank"
                rel="noopener noreferrer"
              >
                {{ inject_svg('youtube', True) | safe }}
              </a>
            </div>
          </div>
        </div>
      </footer>
    </div>

    <!-- Back to Top Button -->
    <button id="back-to-top" class="back-to-top" aria-label="Back to top">
      <svg width="24" height="24" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2">
        <path d="M12 19V5M5 12l7-7 7 7"/>
      </svg>
    </button>

    {% block scripts %}
    <script>
      // Enhanced popover management with click-outside functionality
      document.addEventListener('DOMContentLoaded', function() {
        // Get popover elements
        const searchPopover = document.getElementById('search-modal');
        const sideMenuPopover = document.getElementById('sideMenuPopover');
        const searchButtons = document.querySelectorAll('button[popovertarget="search-modal"]');
        const menuButtons = document.querySelectorAll('button[popovertarget="sideMenuPopover"]');

        // Track popover states manually since :popover-open might not be supported everywhere
        let isSearchOpen = false;
        let isSideMenuOpen = false;

        // Function to close popover safely
        function closePopover(popover, stateVar) {
          try {
            if (popover && typeof popover.hidePopover === 'function') {
              popover.hidePopover();
            }
          } catch (e) {
            // Fallback: remove open attribute or hide with CSS
            if (popover) {
              popover.style.display = 'none';
            }
          }
        }

        // Listen for popover events to track state
        if (searchPopover) {
          searchPopover.addEventListener('toggle', function(e) {
            isSearchOpen = e.newState === 'open';
            if (isSearchOpen) {
              // Close mobile menu if open
              if (isSideMenuOpen && sideMenuPopover) {
                closePopover(sideMenuPopover);
                isSideMenuOpen = false;
                document.body.style.overflow = '';
              }
              // Auto-focus search input when opened
              setTimeout(() => {
                const searchInput = document.getElementById('search-input');
                if (searchInput) searchInput.focus();
              }, 100);
            }
          });
        }

        if (sideMenuPopover) {
          sideMenuPopover.addEventListener('toggle', function(e) {
            isSideMenuOpen = e.newState === 'open';
            // Control body scroll when menu is open
            if (isSideMenuOpen) {
              document.body.style.overflow = 'hidden';
            } else {
              document.body.style.overflow = '';
            }
          });
        }

        // Main click handler for outside clicks
        function handleOutsideClick(event) {
          // Handle search popover - check if clicked on backdrop or outside container
          if (isSearchOpen && searchPopover) {
            const searchContainer = searchPopover.querySelector('.search-container');
            const clickedInsideContainer = searchContainer && searchContainer.contains(event.target);
            const clickedSearchButton = Array.from(searchButtons).some(btn => 
              btn.contains(event.target) || btn === event.target
            );
            
            // Close if clicked on backdrop (the popover itself) or outside the container
            if ((event.target === searchPopover || !clickedInsideContainer) && !clickedSearchButton) {
              closePopover(searchPopover);
              isSearchOpen = false;
            }
          }

          // Handle side menu popover - check if clicked on backdrop or outside container
          if (isSideMenuOpen && sideMenuPopover) {
            const menuContainer = sideMenuPopover.querySelector('.side-menu-container');
            const clickedInsideContainer = menuContainer && menuContainer.contains(event.target);
            const clickedMenuButton = Array.from(menuButtons).some(btn => 
              btn.contains(event.target) || btn === event.target
            );
            
            // Close if clicked on backdrop (the popover itself) or outside the container
            if ((event.target === sideMenuPopover || !clickedInsideContainer) && !clickedMenuButton) {
              closePopover(sideMenuPopover);
              isSideMenuOpen = false;
              document.body.style.overflow = '';
            }
          }
        }

        // Listen for click events
        document.addEventListener('click', handleOutsideClick, true);
        
        // Also listen for mousedown for better mobile support
        document.addEventListener('mousedown', handleOutsideClick, true);
        
        // Handle escape key
        document.addEventListener('keydown', function(event) {
          if (event.key === 'Escape') {
            if (isSearchOpen) {
              closePopover(searchPopover);
              isSearchOpen = false;
            }
            if (isSideMenuOpen) {
              closePopover(sideMenuPopover);
              isSideMenuOpen = false;
              document.body.style.overflow = '';
            }
          }
        });

        // Close sidebar when clicking on navigation links
        if (sideMenuPopover) {
          const sideMenuLinks = sideMenuPopover.querySelectorAll('a[href]');
          sideMenuLinks.forEach(link => {
            link.addEventListener('click', function() {
              setTimeout(() => {
                closePopover(sideMenuPopover);
                isSideMenuOpen = false;
                document.body.style.overflow = '';
              }, 100);
            });
          });
        }
        
        // Ensure search button in mobile menu works
        const mobileSearchBtn = sideMenuPopover?.querySelector('button[popovertarget="search-modal"]');
        if (mobileSearchBtn) {
          mobileSearchBtn.addEventListener('click', function(e) {
            // Close the side menu first
            if (sideMenuPopover && isSideMenuOpen) {
              closePopover(sideMenuPopover);
              isSideMenuOpen = false;
              document.body.style.overflow = '';
            }
            
            // Then open search after a small delay
            setTimeout(() => {
              if (searchPopover && searchPopover.showPopover) {
                try {
                  searchPopover.showPopover();
                  const searchInput = document.getElementById('search-input');
                  if (searchInput) searchInput.focus();
                } catch (err) {
                  console.log('Error opening search popover:', err);
                }
              }
            }, 100);
          });
        }
      });

      // Navbar scroll effect and Back to Top button
      const navbar = document.getElementById('navbar');
      const backToTopBtn = document.getElementById('back-to-top');
      let lastScroll = 0;

      window.addEventListener('scroll', () => {
        const currentScroll = window.pageYOffset;
        
        if (currentScroll > 100) {
          navbar.classList.add('scrolled');
        } else {
          navbar.classList.remove('scrolled');
        }
        
        // Show/hide back to top button
        if (currentScroll > 300) {
          backToTopBtn.classList.add('show');
        } else {
          backToTopBtn.classList.remove('show');
        }
        
        lastScroll = currentScroll;
      });

      // Back to top functionality
      backToTopBtn.addEventListener('click', () => {
        window.scrollTo({
          top: 0,
          behavior: 'smooth'
        });
      });

      // Add active state to current page
      const currentPath = window.location.pathname;
      document.querySelectorAll('.nav-link').forEach(link => {
        if (link.getAttribute('href') === currentPath) {
          link.classList.add('active');
        }
      });
    </script>
    {% endblock %}
    
    <!-- Structured Data -->
    <script type="application/ld+json">
    {
      "@context": "https://schema.org",
      "@type": "Organization",
      "name": "Big0",
      "alternateName": "Big Zero",
      "url": "https://big0.dev",
      "logo": "https://big0.dev/static/logo.svg",
      "description": "AI-powered digital transformation company delivering cutting-edge solutions in artificial intelligence, cloud services, and software development.",
      "sameAs": [
        "https://www.linkedin.com/company/big0",
        "https://github.com/Big0-dev"
      ],
      "address": {
        "@type": "PostalAddress",
        "addressCountry": "PK",
        "addressLocality": "Karachi"
      },
      "contactPoint": {
        "@type": "ContactPoint",
        "telephone": "+92-XXX-XXXXXXX",
        "contactType": "customer service",
        "email": "contact@big0.dev",
        "availableLanguage": ["en"]
      }
    }
    </script>
    
    {% block structured_data %}{% endblock %}
  </body>
</html>