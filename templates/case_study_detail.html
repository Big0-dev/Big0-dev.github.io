{% extends "base.html" %}

{% block title %}{{ current_case_study.title }}{% endblock %}
{% block meta_description %}{{ current_case_study.meta_description }}{% endblock %}
{% block canonical_path %}/case-studies/{{ current_case_study.slug }}.html{% endblock %}

{% block custom_css %}
<link rel="stylesheet" href="{{ static }}/detail-pages.css">
{% endblock %}

{% block content %}
<!-- Case Study Hero -->
<section class="page-hero">
  <div class="container">
    <nav class="breadcrumbs mb-lg">
      <a href="{{ home }}" class="breadcrumb-link">Home</a>
      <span class="breadcrumb-separator">/</span>
      <a href="{{ case_studies }}" class="breadcrumb-link">Work</a>
      <span class="breadcrumb-separator">/</span>
      <span class="breadcrumb-current">{{ current_case_study.title }}</span>
    </nav>

    <div class="max-w-3xl">
      <div style="display: flex; align-items: center; gap: 8px; margin-bottom: 12px; flex-wrap: wrap;">
        <span class="badge badge-cyan">{{ current_case_study.frontmatter.industry | default('Technology') }}</span>
        <span class="badge badge-green">{{ current_case_study.frontmatter.type | default('Case Study') }}</span>
        <span style="color: var(--color-mist); font-size: 13px; display: flex; align-items: center; gap: 4px;">
          <svg width="16" height="16" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" style="display: inline-block; vertical-align: middle;">
            <circle cx="12" cy="12" r="10"/>
            <polyline points="12 6 12 12 16 14"/>
          </svg>
          <span class="reading-time">Calculating...</span>
        </span>
      </div>
      <h1 style="font-family: var(--font-display); font-size: clamp(28px, 4vw, 40px); font-weight: 700; color: var(--color-white); letter-spacing: -0.02em; line-height: 1.15;">{{ current_case_study.title }}</h1>
    </div>
  </div>
</section>

<!-- Case Study Content -->
<section class="section">
  <div class="container">
    <div class="max-w-4xl mx-auto">

      <!-- Challenge and Solution -->
      {% if current_case_study.frontmatter.challenge or current_case_study.frontmatter.solution %}
      <div class="grid-2" style="gap: 16px; margin-bottom: 48px;">
        {% if current_case_study.frontmatter.challenge %}
        <div style="background: var(--color-slate); border: 1px solid var(--color-steel); border-radius: 12px; padding: 24px;">
          <h3 style="font-family: var(--font-display); font-size: 16px; font-weight: 700; color: var(--color-white); margin-bottom: 8px;">The Challenge</h3>
          <p style="color: var(--color-cloud); font-size: 14px; line-height: 1.6; margin: 0;">{{ current_case_study.frontmatter.challenge }}</p>
        </div>
        {% endif %}
        {% if current_case_study.frontmatter.solution %}
        <div style="background: var(--color-slate); border: 1px solid var(--color-steel); border-radius: 12px; padding: 24px;">
          <h3 style="font-family: var(--font-display); font-size: 16px; font-weight: 700; color: var(--color-white); margin-bottom: 8px;">Our Solution</h3>
          <p style="color: var(--color-cloud); font-size: 14px; line-height: 1.6; margin: 0;">{{ current_case_study.frontmatter.solution }}</p>
        </div>
        {% endif %}
      </div>
      {% endif %}

      <!-- Results -->
      {% if current_case_study.frontmatter.results %}
      <div style="margin-bottom: 48px;">
        <h2 style="font-family: var(--font-display); font-size: 22px; font-weight: 700; color: var(--color-white); margin-bottom: 16px; text-align: center;">Results &amp; Impact</h2>
        <div class="cs-results-grid">
          {% set results = current_case_study.frontmatter.results.split(',') %}
          {% set descriptions = current_case_study.frontmatter.result_descriptions.split(',') if current_case_study.frontmatter.result_descriptions else [] %}
          {% for result in results %}
          <div class="cs-result-card">
            <div class="cs-result-val">{{ result.strip() }}</div>
            {% if descriptions[loop.index0] %}
            <p class="cs-result-desc">{{ descriptions[loop.index0].strip() }}</p>
            {% endif %}
          </div>
          {% endfor %}
        </div>
      </div>
      {% endif %}

      <!-- Main Content -->
      <div class="detail-content" style="margin-bottom: 48px;">
        {{ current_case_study.content_html | safe }}
      </div>

      <!-- Technologies -->
      {% if current_case_study.frontmatter.technologies %}
      <div style="margin-bottom: 48px;">
        <h3 style="font-family: var(--font-display); font-size: 16px; font-weight: 700; color: var(--color-white); margin-bottom: 12px;">How We Built It</h3>
        <div style="display: flex; flex-wrap: wrap; gap: 6px;">
          {% for tech in current_case_study.frontmatter.technologies.split(',') %}
          <span class="badge badge-primary">{{ tech.strip() }}</span>
          {% endfor %}
        </div>
      </div>
      {% endif %}

      <!-- Navigation -->
      <div class="text-center">
        <a href="../case-studies.html" class="btn btn-secondary">&larr; Back to Work</a>
      </div>
    </div>
  </div>
</section>

<!-- CTA -->
{% include 'cta.html' %}
{% endblock %}

{% block scripts %}
{{ super() }}
<script>
document.addEventListener('DOMContentLoaded', function() {
  var c = document.querySelector('.detail-content');
  var r = document.querySelector('.reading-time');
  if (c && r) {
    var w = (c.textContent || c.innerText).trim().split(/\s+/).length;
    r.textContent = Math.ceil(w / 200) + ' min read';
  }
  document.querySelectorAll('.faq-item').forEach(function(item) {
    item.querySelector('.faq-question').addEventListener('click', function() {
      var active = item.classList.contains('active');
      document.querySelectorAll('.faq-item').forEach(function(o) {
        if (o !== item) { o.classList.remove('active'); o.querySelector('.faq-question').setAttribute('aria-expanded','false'); }
      });
      item.classList.toggle('active', !active);
      this.setAttribute('aria-expanded', !active);
    });
  });
});
</script>
{% endblock %}
