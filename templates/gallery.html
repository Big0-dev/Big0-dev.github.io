{% extends "base.html" %}

{% block title %}Gallery{% endblock %}
{% block meta_description %}Explore Big0's project gallery showcasing our work in AI, cloud computing, and digital transformation.{% endblock %}
{% block canonical_path %}/gallery.html{% endblock %}

{% block custom_css %}
{% endblock %}

{% block content %}
<!-- Hero Section -->
<section class="page-hero">
  <div class="container">
    <div class="hero-content text-center max-w-3xl mx-auto">
      <h1 class="text-4xl font-bold mb-lg">
        Project <span class="text-gradient">Gallery</span>
      </h1>
      <p class="text-xl text-secondary">
        Showcasing our innovations and client success stories
      </p>
    </div>
  </div>
</section>

<section class="section">
  <div class="container">
    <div class="section-header">
      <h2 class="section-title">Event Highlights</h2>
      <p class="section-subtitle">
        Moments captured from our <span class="text-gradient">journey of innovation</span>
      </p>
    </div>
    
    <div class="grid grid-auto-md gap-lg">
      {% for image in images %}
      <div class="card p-0 overflow-hidden position-relative gallery-item">
        <button 
          class="w-full h-full border-0 bg-transparent cursor-pointer p-0" 
          popovertarget="gallery-lightbox-{{ loop.index }}"
          popovertargetaction="toggle"
          style="aspect-ratio: 16/9;"
        >
          <img 
            src="{{ gallery_url }}/{{ image.filename }}" 
            alt="{{ image.title }}"
            loading="lazy"
            style="width: 100%; height: 100%; object-fit: cover;"
          />
          <div class="position-absolute inset-0 bg-gradient-to-t from-black/80 to-transparent opacity-0 hover:opacity-100 transition-opacity flex items-end p-xl">
            <div class="text-white w-full">
              <h3 class="text-lg font-semibold mb-xs">{{ image.title }}</h3>
              <div class="flex justify-between items-center">
                <div>
                  <span class="badge badge-primary">{{ image.category }}</span>
                  {% if image.date %}
                  <span class="text-sm text-white/70 ml-sm">{{ image.date.strftime('%B %Y') }}</span>
                  {% endif %}
                </div>
                <svg class="w-5 h-5" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2">
                  <path d="M18 13v6a2 2 0 0 1-2 2H5a2 2 0 0 1-2-2V8a2 2 0 0 1 2-2h6"/>
                  <polyline points="15 3 21 3 21 9"/>
                  <line x1="10" y1="14" x2="21" y2="3"/>
                </svg>
              </div>
            </div>
          </div>
        </button>
        
        <!-- Lightbox popover -->
        <div 
          id="gallery-lightbox-{{ loop.index }}" 
          popover="manual"
          class="gallery-lightbox-popover"
        >
          <div class="lightbox-content" onclick="if(event.target === this) document.getElementById('gallery-lightbox-{{ loop.index }}').hidePopover()">
            <button 
              class="lightbox-close" 
              onclick="document.getElementById('gallery-lightbox-{{ loop.index }}').hidePopover()"
              aria-label="Close"
            >
              <svg viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2">
                <line x1="18" y1="6" x2="6" y2="18"/>
                <line x1="6" y1="6" x2="18" y2="18"/>
              </svg>
            </button>
            
            <!-- Navigation -->
            {% if loop.index > 1 %}
            <button 
              class="lightbox-nav prev"
              popovertarget="gallery-lightbox-{{ loop.index }}"
              popovertargetaction="hide"
              onclick="setTimeout(() => document.getElementById('gallery-lightbox-{{ loop.index - 1 }}').showPopover(), 50)"
              aria-label="Previous image"
            >
              <svg viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2">
                <polyline points="15 18 9 12 15 6"/>
              </svg>
            </button>
            {% endif %}
            
            {% if loop.index < images|length %}
            <button 
              class="lightbox-nav next"
              popovertarget="gallery-lightbox-{{ loop.index }}"
              popovertargetaction="hide"
              onclick="setTimeout(() => document.getElementById('gallery-lightbox-{{ loop.index + 1 }}').showPopover(), 50)"
              aria-label="Next image"
            >
              <svg viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2">
                <polyline points="9 18 15 12 9 6"/>
              </svg>
            </button>
            {% endif %}
            
            <div class="lightbox-inner">
              <img src="{{ gallery_url }}/{{ image.filename }}" alt="{{ image.title }}" />
              <div class="lightbox-details">
                <h2>{{ image.title }}</h2>
                <div class="lightbox-meta">
                  <span class="lightbox-category">{{ image.category }}</span>
                  {% if image.date %}
                  <span class="lightbox-date">{{ image.date.strftime('%B %Y') }}</span>
                  {% endif %}
                </div>
                {% if image.description %}
                <p class="lightbox-description">{{ image.description }}</p>
                {% endif %}
                {% if image.tags %}
                <div class="lightbox-tags">
                  {% for tag in image.tags %}
                  <span class="tag">#{{ tag }}</span>
                  {% endfor %}
                </div>
                {% endif %}
              </div>
            </div>
          </div>
        </div>
      </div>
      {% endfor %}
    </div>

    {% if page_num and total_pages and total_pages > 1 %}
    <div class="pagination">
      {% if page_num > 1 %}
      <a href="./gallery{% if page_num == 2 %}.html{% else %}-{{ page_num - 1 }}.html{% endif %}" class="page-link" aria-label="Previous page">
        <svg viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2">
          <polyline points="15 18 9 12 15 6"/>
        </svg>
      </a>
      {% else %}
      <span class="page-link disabled" aria-disabled="true">
        <svg viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2">
          <polyline points="15 18 9 12 15 6"/>
        </svg>
      </span>
      {% endif %}
      
      {% for page in range(1, total_pages + 1) %}
      {% if page == page_num %}
      <span class="page-link active" aria-current="page">{{ page }}</span>
      {% else %}
      <a href="./gallery{% if page > 1 %}-{{ page }}{% endif %}.html" class="page-link">{{ page }}</a>
      {% endif %}
      {% endfor %}
      
      {% if page_num < total_pages %}
      <a href="./gallery-{{ page_num + 1 }}.html" class="page-link" aria-label="Next page">
        <svg viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2">
          <polyline points="9 18 15 12 9 6"/>
        </svg>
      </a>
      {% else %}
      <span class="page-link disabled" aria-disabled="true">
        <svg viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2">
          <polyline points="9 18 15 12 9 6"/>
        </svg>
      </span>
      {% endif %}
    </div>
    {% endif %}
  </div>
</section>

<script>
// Gallery functionality
document.addEventListener('DOMContentLoaded', function() {
  const lightboxes = document.querySelectorAll('.gallery-lightbox-popover');
  
  // Function to close all lightboxes
  function closeAllLightboxes() {
    lightboxes.forEach(lb => {
      if (lb.matches(':popover-open')) {
        lb.hidePopover();
      }
    });
  }
  
  // Ensure all lightboxes start closed
  closeAllLightboxes();

  // Add click handlers to gallery buttons to close other lightboxes first
  const galleryButtons = document.querySelectorAll('.gallery-item button');
  galleryButtons.forEach(button => {
    button.addEventListener('click', function(e) {
      // Close any open lightbox before opening new one
      closeAllLightboxes();
    });
  });

  // Keyboard navigation for lightbox
  document.addEventListener('keydown', function(event) {
    const openPopover = document.querySelector('.gallery-lightbox-popover:popover-open');
    if (!openPopover) return;
    
    if (event.key === 'Escape') {
      openPopover.hidePopover();
    }
    
    // Arrow key navigation
    if (event.key === 'ArrowLeft') {
      const prevBtn = openPopover.querySelector('.lightbox-nav.prev');
      if (prevBtn) prevBtn.click();
    }
    
    if (event.key === 'ArrowRight') {
      const nextBtn = openPopover.querySelector('.lightbox-nav.next');
      if (nextBtn) nextBtn.click();
    }
  });

  // Prevent body scroll when lightbox is open and ensure only one is open
  lightboxes.forEach(lightbox => {
    lightbox.addEventListener('toggle', function(event) {
      if (event.newState === 'open') {
        // Close any other open lightboxes
        lightboxes.forEach(otherLightbox => {
          if (otherLightbox !== lightbox && otherLightbox.matches(':popover-open')) {
            otherLightbox.hidePopover();
          }
        });
        
        document.body.style.overflow = 'hidden';
        // Force center position
        lightbox.style.margin = 'auto';
      } else {
        document.body.style.overflow = '';
      }
    });
  });
});
</script>
{% endblock %}
